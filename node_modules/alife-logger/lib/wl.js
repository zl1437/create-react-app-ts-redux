/** retcode cloud sdk | @version 1.8.3 | @copyright Alibaba Group Holding Limited. */ "use strict";Date.now=Date.now||function(){return(new Date).getTime()};var SEQUENCE=Date.now(),noop=function(){},$a1=function(){var t="object"==typeof console?console.warn:noop;try{var e={warn:t};e.warn.call(e)}catch(n){return noop}return t},util={noop:noop,warn:$a1(),key:"__bl",win:"object"==typeof window&&window.document?window:undefined,regionMap:{cn:"https://arms-retcode.aliyuncs.com/r.png?",sg:"https://arms-retcode-sg.aliyuncs.com/r.png?",sg_2:"https://retcode-sg-lazada.arms.aliyuncs.com/r.png?",daily:"http://arms-retcode-daily.alibaba.net/r.png?",daily_2:"https://arms-retcode-daily.alibaba.net/r.png?",us:"https://retcode-us-west-1.arms.aliyuncs.com/r.png?"},defaultImgUrl:"https://arms-retcode.aliyuncs.com/r.png?",$a2:function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e},each:function(t,e){var n=0,r=t.length;if(this.T(t,"Array"))for(;n<r&&!1!==e.call(t[n],t[n],n);n++);else for(n in t)if(!1===e.call(t[n],t[n],n))break;return t},$a3:function(t,e,n){if("function"!=typeof t)return n;try{return t.apply(this,e)}catch(r){return n}},T:function(t,e){var n=Object.prototype.toString.call(t).substring(8).replace("]","");return e?n===e:n},$a4:function(t,e){if(!t)return"";if(!e)return t;var n=this,r=n.T(e);return"Function"===r?n.$a3(e,[t],t):"Array"===r?(this.each(e,function(e){t=n.$a4(t,e)}),t):"Object"===r?t.replace(e.rule,e.target||""):t.replace(e,"")},$a5:function(t,e){if(!t||!e)return!1;if((this.isString(e)||e.source||"Function"===this.T(e))&&(e=[e]),!this.isArray(e))return util.warn("[arms] invalid rules of ignore config, (list of) String/RegExp/Funcitons are available"),!1;for(var n,r=[],i=0,o=e.length;i<o;i++)if(n=e[i],this.isString(n))r.push(n.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"));else if(n&&n.source)r.push(n.source);else if(n&&"Function"===this.T(n)&&!0===this.$a3(n,[t],!1))return!0;var a=new RegExp(r.join("|"),"i");return!!(r.length&&a.test&&a.test(t))},J:function(t){if(!t||"string"!=typeof t)return t;var e=null;try{e=JSON.parse(t)}catch(n){}return e},pick:function(t){return 1===t||1===Math.ceil(Math.random()*t)},$a6:function(t){if("sample"in t){var e=t.sample,n=e;e&&/^\d+(\.\d+)?%$/.test(e)&&(n=parseInt(100/parseFloat(e))),0<n&&1>n&&(n=parseInt(1/n)),n>=1&&n<=100?t.sample=n:delete t.sample}return t},on:function(t,e,n,r,i){return t.addEventListener?(i=i||!1,t.addEventListener(e,function o(a){r&&t.removeEventListener(e,o,i),n.call(this,a)},i)):t.attachEvent&&t.attachEvent("on"+e,function a(i){r&&t.detachEvent("on"+e,a),n.call(this,i)}),this},off:function(t,e,n){return n?(t.removeEventListener?t.removeEventListener(e,n):t.detachEvent&&t.detachEvent(e,n),this):this},delay:function(t,e){return-1===e?(t(),null):setTimeout(t,e||0)},ext:function(t){for(var e=1,n=arguments.length;e<n;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},sub:function(t,e){var n={};return this.each(t,function(t,r){-1!==e.indexOf(r)&&(n[r]=t)}),n},uu:function(){for(var t,e,n=20,r=new Array(n),i=Date.now().toString(36).split("");n-- >0;)e=(t=36*Math.random()|0).toString(36),r[n]=t%3?e:e.toUpperCase();for(var o=0;o<8;o++)r.splice(3*o+2,0,i[o]);return r.join("")},seq:function(){return(SEQUENCE++).toString(36)},decode:function(t){try{t=decodeURIComponent(t)}catch(e){}return t},encode:function(t,e){try{t=e?encodeURIComponent(t).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(t)}catch(n){}return t},serialize:function(t){t=t||{};var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&t[n]!==undefined&&e.push(n+"="+this.encode(t[n],"msg"===n));return e.join("&")},$a7:function(t,e){if(!t||"string"!=typeof t)return!1;var n=/arms-retcode[\w-]*\.aliyuncs/.test(t);return!n&&e&&(n=/(\.png)|(\.gif)|(alicdn\.com)/.test(t)),!n},$a8:function(t){return!(!t||!t.message)&&!/failed[\w\s]+fetch/i.test(t.message)},$a9:function(t){return t&&"string"==typeof t?t.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},$aa:function(t){return t&&"string"==typeof t?t.replace(/\?.*$/,""):""},$ab:function(t){return function(){return t+"() { [native code] }"}},checkSameOrigin:function(t,e){if(!e||!t)return!1;var n="//"+e.split("/")[2];return t===e||t.slice(0,e.length+1)===e+"/"||t===n||t.slice(0,n.length+1)===n+"/"||!/^(\/\/|http:|https:).*/.test(t)},getRandIP:function(){for(var t=[],e=0;e<4;e++){var n=Math.floor(256*Math.random());t[e]=(n>15?"":"0")+n.toString(16)}return t.join("")},getSortNum:function(t){return t?(t+=1)>=1e3&&t<=9999?t:t<1e3?t+1e3:t%1e4+1e3:1e3},getRandNum:function(t){return t&&"string"==typeof t?t.length<5?this.getNum(5):t.substring(t.length-5):this.getNum(5)},getNum:function(t){for(var e=[],n=0;n<t;n++){var r=Math.floor(16*Math.random());e[n]=r.toString(16)}return e.join("")},getCurDomain:function(){return location&&location.hostname||""},parseFetchHeaders:function(t){if(!t)return{};var e={};try{if("function"==typeof t.keys)for(var n=t.keys(),r=n.next();!r.done;){var i=r.value;e[i]=t.get(i),r=n.next()}else e=t}catch(o){e={}}return e},parseXhrHeaders:function(t){if(!t&&"string"!=typeof t)return{};var e={};try{var n=t.split("\r\n");e=n.reduce(function(t,e){var n=e.split(": ");return t[n[0]]=n[1],t},{})}catch(r){e={}}return e},getQuerys:function(t){if(!t)return"";var e={},n=[],r="",i="";try{var o=[];if(t.indexOf("?")>=0&&(o=t.substring(t.indexOf("?")+1,t.length).split("&")),o.length>0)for(var a in o)r=(n=o[a].split("="))[0],i=n[1],e[r]=i}catch(s){e={}}return e},getFetchSnapshot:function(t,e,n){var r,i;try{var o=(t&&"string"!=typeof t[0]?t[0].url:t[0])||"",a=(t&&"string"!=typeof t[0]?t[0]:t[1])||{},s="POST"===a.method.toUpperCase()?a.body:this.getQuerys(o);r={originApi:o,method:a.method||"unknown",params:s,response:e||"",reqHeaders:this.parseFetchHeaders(a.headers||null),resHeaders:this.parseFetchHeaders(n)},i="function"==typeof encodeURIComponent&&JSON&&encodeURIComponent(JSON.stringify(r))||"{}"}catch(u){i="{}"}return i},getXhrSnapshot:function(t,e,n){if(!t||!e||!n)return{};var r,i;try{r={originApi:t,method:e,params:this.getQuerys(t),response:n.responseText||n.responseXml||"",reqHeaders:{},resHeaders:this.parseXhrHeaders("function"==typeof n.getAllResponseHeaders&&n.getAllResponseHeaders()||"")},i="function"==typeof encodeURIComponent&&JSON&&encodeURIComponent(JSON.stringify(r))||"{}"}catch(o){i="{}"}return i},isFunction:function(t){return"function"==typeof t},isPlainObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},joinRegExp:function(t){for(var e,n=[],r=0,i=t.length;r<i;r++)e=t[r],this.isString(e)?n.push(e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):e&&e.source&&n.push(e.source);return new RegExp(n.join("|"),"i")},reWriteMethod:function(t,e,n){if(null!==t){var r=t[e];t[e]=n(r)}}},util_1=util,sendBeacon=function(t,e){"object"==typeof t&&(t=util_1.serialize(t));var n=e+t;window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?window.navigator.sendBeacon(n,"&post_res="):util_1.warn("[arms] navigator.sendBeacon not surported")},pushToQueue=function(t,e){var n;{if("error"!==e.t||!(n=t.$ac[0])||"error"!==n.t||e.msg!==n.msg){if("behavior"===e.t){var r=t.$ac&&t.$ac.length;if(r>0&&"behavior"===t.$ac[r-1].t){var i=e.behavior||[];t.$ac[r-1].behavior.concat(i)}else t.$ac.push(e)}else t.$ac.unshift(e);return t.$ad(function(){t.$ae=util_1.delay(function(){t.$af()},t.$ac[0]&&"error"===t.$ac[0].t?3e3:-1)}),!0}n.times++}},Base=function(t){return this.ver="1.8.3",this._conf=util_1.ext({},Base.dftCon),this.$ag={},this.$ac=[],this.hash=util_1.seq(),this.$ah(),this.setConfig(t),this.rip=util_1.getRandIP(),this.record=999,this["EagleEye-TraceID"]=this.getTraceId()["EagleEye-TraceID"],this._common={},this};Base.dftCon={sample:1,pvSample:1,tag:"",imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",region:null,ignore:{ignoreUrls:[],ignoreApis:[],ignoreErrors:[]},release:undefined,environment:"production"},Base.prototype={constructor:Base,$ad:function(t){return t()},$ai:function(){var t=this._conf.page;return util_1.$a3(t,[],t+"")},setPage:function(){},setConfig:function(t){t&&"object"==typeof t&&(util_1.$a6(t),t=this.$aj(t),this._conf=util_1.ext({},this._conf,t))},$aj:function(t){var e=t.region,n=t.imgUrl;if(e){var r=util_1.regionMap[e];return t.imgUrl=r||util_1.defaultImgUrl,t}return n&&(t.imgUrl=n),t},$ak:function(t){if(this.getConfig("debug"))return!0;var e=util_1.regionMap,n=!1;for(var r in e)if(e[r]===t){n=!0;break}return!n&&util_1.warn("[retcode] invalid url: "+t),n},$al:function(){},$am:function(t){sendBeacon(t,this.getConfig("imgUrl"))},$an:function(){},$ao:function(){return{}},setCommonInfo:function(t){t&&"object"==typeof t&&(this._common=util_1.ext({},this._common,t))},$ah:function(){this.session=util_1.uu(),this.sBegin=Date.now()},getTraceId:function(){var t=this.rip,e=Date.now(),n=util_1.getSortNum(this.record),r=t+e+n+util_1.getRandNum(this._conf.pid);return this["EagleEye-TraceID"]=r,this.record=n,{"EagleEye-TraceID":r}},getSessionId:function(){return{"EagleEye-SessionID":this.session}},getConfig:function(t){return t?this._conf[t]:util_1.ext({},this._conf)},$ap:function(t){return 1===t||("boolean"==typeof this.$ag[t]?this.$ag[t]:(this.$ag[t]=util_1.pick(t),this.$ag[t]))},$af:function(){var t;clearTimeout(this.$ae),this.$ae=null;for(var e=this._conf&&"function"==typeof this._conf.sendRequest;t=this.$ac.pop();)"res"===t.t?this.$an(t,"res"):"error"===t.t?this.$an(t,"err"):"api"===t.t?this.$an(t,"apiSnapshot"):"behavior"===t.t?this.$an(t,"behavior"):"health"===t.t&&!e&&window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?this.$am(t):this.$al(t);return this},_lg:function(t,e,n){var r=this._conf,i=this.$ai(),o=r.ignore||{},a=o.ignoreErrors,s=o.ignoreUrls,u=o.ignoreApis;return util_1.$a5(i,s)||util_1.$a5(util_1.decode(i),s)?this:"error"===t&&(util_1.$a5(e.msg,a)||util_1.$a5(util_1.decode(e.msg),a))?this:"api"===t&&(util_1.$a5(e.api,u)||util_1.$a5(util_1.decode(e.api),u))?this:this.$ak(r.imgUrl)&&e&&!r.disabled&&r.pid?n&&!this.$ap(n)?this:(e=util_1.ext({t:t,times:1,page:i,tag:r.tag||"",release:r.release||"",environment:r.environment,begin:Date.now()},e,this.$ao(),this._common,{pid:r.pid,_v:this.ver,sid:this.session,sampling:n||1,z:util_1.seq(),c1:r.c1,c2:r.c2,c3:r.c3}),pushToQueue(this,e)):this},custom:function(t,e){if(!t||"object"!=typeof t)return this;var n=!1,r={begin:Date.now()};return util_1.each(t,function(t,e){return!(n=e&&e.length<=20)&&util_1.warn("[retcode] invalid key: "+e),r["x-"+e]=t,n}),n?this._lg("custom",r,e||1):this}};var base=Base,validApiKeys=["api","success","time","code","msg","trace","traceId","begin","sid","seq","domain"],parseStatData=function(t,e){var n=t.split("::");return n.length>1?util_1.ext({group:n[0],key:n[1]},e):util_1.ext({group:"default_group",key:n[0]},e)},Reporter=function(t){base.call(this,t);var e;try{e="object"==typeof performance?performance.timing.fetchStart:Date.now()}catch(n){e=Date.now()}return this._startTime=e,this};Reporter.prototype=util_1.$a2(base.prototype),util_1.ext(base.dftCon,{startTime:null}),util_1.ext(Reporter.prototype,{constructor:Reporter,_super:base,sum:function(t,e,n){try{return this._lg("sum",parseStatData(t,{val:e||1,begin:Date.now()}),n)}catch(r){util_1.warn("[retcode] can not get parseStatData: "+r)}},avg:function(t,e,n){try{return this._lg("avg",parseStatData(t,{val:e||0,begin:Date.now()}),n)}catch(r){util_1.warn("[retcode] can not get parseStatData: "+r)}},percent:function(t,e,n,r){try{return this._lg("percent",parseStatData(t,{subkey:e,val:n||0,begin:Date.now()}),r)}catch(i){util_1.warn("[retcode] can not get parseStatData: "+i)}},msg:function(t,e){if(t&&!(t.length>180))return this.custom({msg:t},e)},error:function(t,e){if(!t)return util_1.warn("[retcode] invalid param e: "+t),this;1===arguments.length?("string"==typeof t&&(t={message:t},e={}),"object"==typeof t&&(e=t=t.error||t)):("string"==typeof t&&(t={message:t}),"object"!=typeof e&&(e={}));var n=t.name||"CustomError",r=t.message||"",i=t.stack||"";e=e||{};var o={begin:Date.now(),cate:n,msg:r&&r.substring(0,1e3),stack:i&&i.substring(0,1e3),file:util_1.$aa(e.filename||""),line:e.lineno||"",col:e.colno||"",err:{msg_raw:util_1.encode(r),stack_raw:util_1.encode(i)}},a=(this.getConfig("ignore")||{}).ignoreErrors;return util_1.$a5(o.msg,a)||util_1.$a5(util_1.decode(o.msg),a)?this:(this.$as&&this.$as("error",o),this._lg("error",o,1))},behavior:function(t){if(t){var e="object"==typeof t&&t.behavior?t:{behavior:t};return this.$as&&this.$as("behavior",e),this._lg("behavior",e,1)}},api:function(t,e,n,r,i,o,a,s,u,c){if(!t)return util_1.warn("[retcode] api is null"),this;if(t="string"==typeof t?{api:t,success:e,time:n,code:r,msg:i,begin:o,traceId:a,sid:s,domain:c}:util_1.sub(t,validApiKeys),!util_1.$a7(t.api))return this;if(t.code=t.code||"",t.msg=t.msg||"",t.success=t.success?1:0,t.time=+t.time,t.begin=t.begin,t.traceId=t.traceId||"",t.sid=t.sid||"",t.domain=t.domain||"",t.success?t.apiSnapshot&&delete t.apiSnapshot:t.apiSnapshot=u,!t.api||isNaN(t.time))return util_1.warn("[retcode] invalid time or api"),this;var f=(this.getConfig("ignore")||{}).ignoreApis;if(util_1.$a5(t.api,f)||util_1.$a5(util_1.decode(t.api),f))return this;this.$as&&this.$as("api",t);var g={type:"api",data:{message:t.msg,url:t.api,status:t.code},timestamp:t.begin};try{this.getConfig("behavior")&&this.addBehavior&&this.addBehavior(g)}catch(l){}return this._lg("api",t,t.success&&this.getConfig("sample"))},speed:function(t,e,n){var r=this,i=this.getConfig("startTime")||this._startTime;return/^s(\d|1[0])$/.test(t)?(e="number"!=typeof e?Date.now()-i:e>=i?e-i:e,r.$aq=r.$aq||{},r.$aq[t]=e,r.$aq.begin=i,clearTimeout(r.$ar),r.$ar=setTimeout(function(){n||(r.$aq.page=r.$ai(!0)),r._lg("speed",r.$aq),r.$aq=null},5e3),r):(util_1.warn("[retcode] invalid point: "+t),r)},performance:function(t){if(t&&"object"==typeof t){var e={},n=this.getConfig("autoSendPerf");if(n&&t.autoSend&&!this.$at)return this.$at=!0,this._lg("perf",t,this.getConfig("sample"));for(var r in t)(/^t([1-9]|1[0])$/.test(r)||"ctti"===r||"cfpt"===r)&&(e[r]=t[r]);if(n&&!0!==t.autoSend)this.$au=util_1.ext(this.$au||{},e);else if(!1===n&&!this.$at){if(!this.$au||"object"!=typeof this.$au)return;return e=util_1.ext(this.$au,e),this.$at=!0,this._lg("perf",e,this.getConfig("sample"))}}},resource:function(t,e){if(!t||!util_1.isPlainObject(t))return util_1.warn("[arms] invalid param data: "+t),this;var n=Object.keys(t),r=["begin","dom","load","res","dl"],i=!1;for(var o in r){if(n.indexOf(r[o])<0){i=!0;break}}if(i)return util_1.warn("[arms] lack param data: "+t),this;var a={begin:t.begin||Date.now(),dom:t.dom||"",load:t.load||"",res:util_1.isArray(t.res)?JSON.stringify(t.res):JSON.stringify([]),dl:t.dl||""};return this._lg("res",a,e)}}),Reporter._super=base,Reporter._root=base,base.Reporter=Reporter;var reporter=Reporter,MiniProgramLogger=function(t){t&&t.pid||util_1.warn("[arms] pid is a required prop to instatiate MiniProgramLogger");var e=this;return reporter.call(e,t),e._health={errcount:0,apisucc:0,apifail:0},e.DEFAUT_PAGE_PATH="[app]",e.isSendPerf=!1,e.$as=function(t,n){"error"===t?e._health.errcount++:"api"===t&&e._health[n.success?"apisucc":"apifail"]++},"function"==typeof e.$av&&e.$av(),e._conf&&e._conf.behavior&&"function"==typeof e.$aw&&e.$aw(),"function"==typeof e.$ax&&e.$ax(),this};MiniProgramLogger.prototype=util_1.$a2(reporter.prototype),util_1.ext(reporter._root.dftCon,{uid:null,disableHook:!1,enableLinkTrace:!1,behavior:!1,sendRequest:function(){},getCurrentPage:function(){}}),util_1.ext(MiniProgramLogger.prototype,{constructor:MiniProgramLogger,_super:reporter,$ad:function(t){t()},$al:function(t,e){if(this.getConfig("debug"))"undefined"!=typeof console&&console&&"function"==typeof console.log&&console.log("[arms] [DEBUG MODE] log data",t);else{var n=this.getConfig("imgUrl");"object"==typeof t&&(t=util_1.serialize(t));var r=n+t;e&&(r+="&post_res=");var i=this._conf.sendRequest;if("function"==typeof i)try{i(r,e)}catch(o){util_1.warn("[arms] error in $al",o)}}},$an:function(t,e){var n={};n[e]=t[e],delete t[e],this.$al(t,n)},$ai:function(){var t=this._conf.getCurrentPage;if("function"==typeof t)try{var e=t();if(e&&"string"==typeof e)return e}catch(n){util_1.warn("[arms] error in $ai",n)}return"string"==typeof t&&t?t:this.DEFAUT_PAGE_PATH},setConfig:function(t){if(t&&"object"==typeof t){util_1.$a6(t),t=this.$aj(t);var e=this._conf;this._conf=util_1.ext({},this._conf,t);var n="disableHook";n in t&&e[n]!==t[n]&&(t[n]?"function"==typeof this.removeHook&&this.removeHook():"function"==typeof this.addHook&&this.addHook())}},pageShow:function(){var t=this;t.$ah(),t.$ay(),clearTimeout(t.$az),t.$b0(),t.$az=setTimeout(function(){t.$b1()},50),t.sessionPage=t.$ai()},pageHide:function(){this.$b0()},addHook:function(){return this},removeHook:function(){return this},hookApp:function(t){var e=this,n={onError:function(n){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),i=t.onError;try{e.error(n),e.getConfig("behavior")&&"function"==typeof e.reportBehavior&&e.reportBehavior()}catch(n){util_1.warn("[arms] error in hookApp:onError",n)}if("function"==typeof i)return i.apply(this,r)}};return util_1.ext({},t,n)},hookPage:function(t){var e=this,n={onShow:function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),r=t.onShow;try{e.pageShow()}catch(i){util_1.warn("[arms] error in hookPage:pageShow",i)}if("function"==typeof r)return r.apply(this,n)},onHide:function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),r=t.onHide;try{e.pageHide()}catch(i){util_1.warn("[arms] error in hookPage:onHide",i)}if("function"==typeof r)return r.apply(this,n)},onUnload:function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),r=t.onUnload;try{e.pageHide()}catch(i){util_1.warn("[arms] error in hookPage:onUnload",i)}if("function"==typeof r)return r.apply(this,n)}};return util_1.ext({},t,n)},$av:function(){},$ax:function(){this.setCommonInfo({app:"mini_common",uid:this._conf.uid})},$b1:function(){var t=this;t.$ad(function(){t._lg("pv",{},t.getConfig("pvSample"))})},$ay:function(){var t=this;t.isSendPerf||(t.$ad(function(){var e={fpt:Date.now()-t.sBegin};t._lg("perf",e,t.getConfig("sample"))}),t.isSendPerf=!0)},$b0:function(){this.$b2(),this.$aq&&(this._lg("speed",this.$aq),this.$aq=null,clearTimeout(this.$ar)),this.$af()},$b2:function(){if(this.sessionPage){var t=util_1.ext({},this._health);t.healthy=t.errcount>0?0:1,t.begin=Date.now();var e=t.begin-this.sBegin;t.page=this.sessionPage,t.stay=e,this._lg("health",t,1),this._health={errcount:0,apisucc:0,apifail:0},this.sessionPage=null}}});var singleton=null,generator=function(t){return singleton||(singleton=new MiniProgramLogger(t||{})),singleton};MiniProgramLogger.createExtraInstance=function(t){t&&"object"==typeof t?(t.disableHook=!0,t.behavior=!1):t={disableHook:!0,behavior:!1};return new MiniProgramLogger(t)},MiniProgramLogger.init=generator,MiniProgramLogger.singleton=generator,MiniProgramLogger._super=reporter,MiniProgramLogger._root=reporter._root,reporter.MiniProgramLogger=MiniProgramLogger;var miniProgramLogger=MiniProgramLogger,hook=function(t){var e=util_1,n=null,r={};return e.ext(t.prototype,{addHook:function(){return this.isHookInstantiated?this:(function(){var t=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request){n=wx;var i={request:function(n){var r=(new Date).getTime();if(n&&"object"==typeof n&&n[0]){var i,o,a=n[0],s=e.$a9(a.url),u=a.success,c=a.fail,f=a&&a.header;f&&"object"==typeof f||(f={});var g={};if(t.getConfig("enableLinkTrace")){var l=f["EagleEye-pAppName"];if(i=f["EagleEye-TraceID"],o=f["EagleEye-SessionID"],i||(i=t.getTraceId()["EagleEye-TraceID"],g["EagleEye-TraceID"]=i),o||(o=t.getSessionId()["EagleEye-SessionID"],g["EagleEye-SessionID"]=o),!l){var p=t.getConfig("pid");g["EagleEye-pAppName"]=p}}a.success=function(){var a=(new Date).getTime();if(e.$a7(s,!0)){var c=arguments&&arguments[0]&&arguments[0].statusCode||200;t.api({api:n[0].url,success:!0,time:a-r,code:c,begin:r,traceId:i,sid:o})}u&&u.apply(t,[].slice.call(arguments))},a.fail=function(){var a=(new Date).getTime();if(e.$a7(s,!0)){var u="";arguments&&arguments[0]&&"object"==typeof arguments[0]&&(u=(u=JSON.stringify(arguments[0])).substring(0,1e3));var f=arguments&&arguments[0]&&arguments[0].statusCode||"FAILED";t.api({api:n[0].url,success:!1,time:a-r,code:f,msg:u,begin:r,traceId:i,sid:o})}c&&c.apply(t,[].slice.call(arguments))},a.header=e.ext({},f,g)}}};for(var o in wx)if(i[o]){var a=o.toString();r[a]=function(){return i[a](arguments),n[a].apply(n,[].slice.call(arguments))}}else r[o]=n[o];wx=r}}.call(this),this.isHookInstantiated=!0,this)},removeHook:function(){return this.isHookInstantiated?(function(){"undefined"!=typeof wx&&wx&&n&&(wx=n,n=null)}.call(this),this.isHookInstantiated=!1,this):this},$av:function(){return this.$b3?this:(this.getConfig("disableHook")||this.addHook(),this.$b3=!0,this)}}),t},miniBehavior=function(t){var e=[],n=util_1.reWriteMethod,r={consoleBehavior:function(){if(console){var t=["debug","info","warn","log","error"],e=null;if(Function&&(e=Function.prototype.apply||Function.apply),"function"==typeof e)for(var r=this,i=0;i<t.length;i++){var o=t[i];"function"==typeof console[o]&&n(console,o,function(t){var n=o;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s={type:"console",data:{level:n,message:o}};r&&"function"==typeof r.addBehavior&&r.addBehavior(s),"function"==typeof t&&e.call(t,console,o)}})}}}};return util_1.ext(t.prototype,{addBehavior:function(t){if(this.getConfig("behavior")&&t&&"object"==typeof t){var n="";this._conf&&"function"==typeof this._conf.getCurrentPage&&(n=this._conf.getCurrentPage());var r=null;try{r=Date.now()}catch(s){return void util_1.warn("[arms] error in Date.now",s)}var i={},o=t.data||{};if(t.type)i=o;else{if("string"!=typeof o.name||"string"!=typeof o.message)return;i.name=o.name.substr(0,20),i.message=o.message.substr(0,200)}i.message&&(i.message=util_1.encode(i.message));var a={type:t.type||"custom",data:i||{},timestamp:t.timestamp||r,page:t.page||n};return e.push(a),e=e.slice(-100)}},getBehavior:function(){return e||[]},setBehavior:function(t){return t&&(e=t),e},reportBehavior:function(){var t=this;t.getConfig("behavior")&&(t.$b4&&(clearTimeout(t.$b4),t.$b4=undefined),t.$b4=setTimeout(function(){e&&e.length>0&&("function"==typeof t.behavior&&t.behavior(e),e=[])},0))},$aw:function(){}}),r},behavior=function(t,e){var n=null,r="",i=function(t){return function(){if(t&&n){var e=n,r=t+"timmer";e[r]&&(clearTimeout(e[r]),e[r]=undefined),e[r]=setTimeout(function(){"function"==typeof e.addBehavior&&e.addBehavior({type:"ui.default",data:{level:t}})},100)}}},o=miniBehavior(t)||{};util_1.ext(t.prototype,{$aw:function(){if(!this.hasInitBehavior&&!n&&void 0!==e&&e){try{"function"==typeof o.consoleBehavior&&o.consoleBehavior.call(this),e&&("function"==typeof e.onKeyboardHeightChange&&e.onKeyboardHeightChange(i("KeyboardHeightChange")),"function"==typeof e.onPageNotFound&&e.onPageNotFound(i("PageNotFound")),"function"==typeof e.onAppShow&&e.onAppShow(i("AppShow")),"function"==typeof e.onAppHide&&e.onAppHide(i("AppHide"))),e&&"function"==typeof e.onAppRoute&&e.onAppRoute(function(t){var e={type:"navigation",data:{level:t&&t.openType||"unknown",from:r||"unknown",to:t&&t.path||"unknown"}};n&&"function"==typeof n.addBehavior&&n.addBehavior(e),r=t&&t.path||""}),e&&"function"==typeof e.onError&&e.onError(this.reportBehavior.bind(this))}catch(t){util_1.warn("[arms] error in initBehavior",t)}return n=this,this.hasInitBehavior=!0,this}}})},ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY="ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY",WXLogger=function(t){return miniProgramLogger.call(this,t),this};WXLogger.prototype=util_1.$a2(miniProgramLogger.prototype),util_1.ext(miniProgramLogger._root.dftCon,{sendRequest:function(t,e){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.request)try{var n,r="GET";e&&(r="POST",n=JSON.stringify(e)),wx.request({url:t,method:r,data:n,fail:function(t){util_1.warn("[arms] sendRequest fail",t)}})}catch(i){util_1.warn("[arms] error in conf sendRequest",i)}},getCurrentPage:function(){if("function"==typeof getCurrentPages)try{var t=getCurrentPages()||[],e=t[t.length-1];return e&&e.route||null}catch(n){util_1.warn("[arms] error in conf getCurrentPage",n)}}}),util_1.ext(WXLogger.prototype,{constructor:WXLogger,_super:miniProgramLogger,$ax:function(){this.setCommonInfo({app:"mini_wx"}),this.$b5(),this.$b6(),this.$b7()},$b7:function(){if(this._conf&&this._conf.uid)this.setCommonInfo({uid:this._conf.uid});else if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getStorageSync)try{var t=wx.getStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY);if(t&&"string"==typeof t)this.setCommonInfo({uid:t});else if("function"==typeof wx.setStorageSync){var e=util_1.uu();wx.setStorageSync(ARMS_STORAGE_MINIPROGRAM_WX_UID_KEY,e),this.setCommonInfo({uid:e})}}catch(n){util_1.warn("[arms] error in $b7",n)}},$b5:function(){if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getSystemInfoSync)try{var t=wx.getSystemInfoSync();"object"==typeof t&&this.setCommonInfo({sr:(t.screenWidth||0)+"x"+(t.screenHeight||0),vp:(t.windowWidth||0)+"x"+(t.windowHeight||0),dpr:t.pixelRatio,ul:t.language})}catch(e){util_1.warn("[arms] error in $b5",e)}},$b6:function(){var t=this;if("undefined"!=typeof wx&&wx&&"function"==typeof wx.getNetworkType)try{wx.getNetworkType({success:function(e){e&&"string"==typeof e.networkType&&t.setCommonInfo({ct:e.networkType})},fail:function(t){util_1.warn("[arms] $b6 getNetworkType fail",t)}})}catch(e){util_1.warn("[arms] error in $b6",e)}},hookApp:function(t){var e=this,n={onError:function(n){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),i=t.onError;try{if(n&&"object"==typeof n&&e.error(n),n&&"string"==typeof n){var o=n.split("\n"),a="",s="";o.length>1&&(a=o[0]&&o[0].length<100?o[0]:o[0].substring(0,100),s=o[1]),e.error({name:a,message:s||n,stack:n})}}catch(n){util_1.warn("[arms] error in hookApp:onError",n)}if("function"==typeof i)return i.apply(this,r)}};return util_1.ext({},t,n)}}),hook(WXLogger),"undefined"!=typeof wx&&wx&&behavior(WXLogger,wx);var singleton$1=null,generator$1=function(t){return singleton$1||(singleton$1=new WXLogger(t||{})),singleton$1};WXLogger.createExtraInstance=function(t){t&&"object"==typeof t?(t.disableHook=!0,t.behavior=!1):t={disableHook:!0,behavior:!1};return new WXLogger(t)},WXLogger.init=generator$1,WXLogger.singleton=generator$1,WXLogger._super=miniProgramLogger,WXLogger._root=miniProgramLogger._root,miniProgramLogger.WXLogger=WXLogger;var clazz=WXLogger;module.exports=clazz;