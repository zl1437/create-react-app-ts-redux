
const path = require('path');
const fs = require('fs');
const defaultFilePath = path.resolve(".",'DEPLOY'); //项目根目录下DEPLOY文件路径

module.exports = (deployFile = defaultFilePath) => {
    if (!fs.existsSync(deployFile)){
        return {
            'status': -1,
            'info': '文件不存在',
        }
    }
    let contentText = fs.readFileSync(deployFile, 'utf-8');
    if (!contentText){
        return {
            'status': -2,
            'info': '该文件为空文件'
        }
    }

    try{
        let result = {};
        let lines = contentText.split("\n");
        for (let lineStr of lines){
            let pieces = lineStr.split('|', 2);
            if (!pieces[0]) continue;
            let k = pieces[0].replace(/^\s+/, '').replace(/\s+$/, '');
            let v = pieces[1].replace(/^\s+/, '').replace(/\s+$/, '');
            if (!k) continue;
            result[k] = v;
        }

        return {
            'status': 1,
            'info': '读取成功',
            'data': result
        }
    }catch (e){
        return {
            'status': -3,
            'info': '读取失败',
        }
    }
}